<div>
    <div class="form-body">
        <form nz-form nzLayout="vertical" [formGroup]="quotationForm">
            <div class="row">
                <div class="col-md-6">
                    <nz-form-item>
                        <nz-form-label nzRequired class="fw-semibold" nzFor="project_type">Project Type</nz-form-label>
                        <nz-form-control>
                            <nz-select nzShowSearch nzPlaceHolder="Select Type" formControlName="project_type">
                                <nz-option nzLabel="Manual" nzValue="manual"></nz-option>
                                <nz-option nzLabel="Existing File" nzValue="existing"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div *ngIf="quotationForm.get('project_type')?.value === 'existing'" class="col-md-6">
                    <nz-form-item class="flex-column">
                        <nz-form-label [nzRequired]="true" class="fw-semibold">Upload Project File</nz-form-label>
                        <input type="file" (change)="onFileExcelChange($event)" accept=".xls,.xlsx" />
                        <!-- <nz-form-control>
                          <nz-upload
                            [(nzFileList)]="fileList"
                            [nzBeforeUpload]="beforeUpload"
                            [nzShowUploadList]="true"
                            [nzWithCredentials]="true"
                            [nzShowButton]="fileList.length < 3"
                            [nzSize]="5000"
                            [nzRemove]="removeDocument"
                          >
                            <button nz-button>
                              <i nz-icon nzType="upload"></i>
                              <span>Click to Upload</span>
                            </button>
                          </nz-upload>
                        </nz-form-control> -->
                      </nz-form-item>
                </div>
                <div class="col-md-4">
                    <nz-form-item>
                        <nz-form-label nzRequired class="fw-semibold" nzFor="project_id">Project ID</nz-form-label>
                        <nz-form-control>
                            <nz-select nzShowSearch nzPlaceHolder="Select Type" formControlName="project_id">
                                <nz-option nzLabel="PR2123" nzValue="PR2123"></nz-option>
                                <nz-option nzLabel="ASD223" nzValue="ASD223"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div class="col-md-4">
                    <nz-form-item>
                        <nz-form-label nzRequired nzFor="revision" class="fw-semibold">Revision</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="revision" id="revision" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div class="col-md-4">
                    <nz-form-item>
                        <nz-form-label nzRequired nzFor="description" class="fw-semibold">Description</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="description" id="description" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div class="col-md-4">
                    <nz-form-item>
                        <nz-form-label nzRequired nzFor="location" class="fw-semibold">Location</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="location" id="location" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div class="col-md-4">
                    <nz-form-item>
                        <nz-form-label nzRequired nzFor="consultant" class="fw-semibold">Consultant</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="consultant" id="consultant" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div class="col-md-4">
                    <nz-form-item>
                        <nz-form-label nzRequired nzFor="consultant_location" class="fw-semibold">Consultant Location</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="consultant_location" id="consultant_location" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div class="col-md-4">
                    <nz-form-item>
                        <nz-form-label nzRequired nzFor="date" class="fw-semibold">Date</nz-form-label>
                        <nz-form-control>
                            <nz-date-picker class="w-100" formControlName="date" id="date" nzPlaceHolder="pick a date"></nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div class="col-md-4">
                    <nz-form-item class="mb-4">
                        <nz-form-label nzRequired nzFor="pic" class="fw-semibold">Engineer PIC</nz-form-label>
                        <nz-form-control>
                            <ng-container *ngIf="pic$ | async as pic; else picLoad">
                                <nz-select nzShowSearch nzMode="tags" nzPlaceHolder="Select PIC" formControlName="pic">
                                    <nz-option
                                    *ngFor="let p of pic"
                                        [nzLabel]="p.name" 
                                        [nzValue]="p.pic_id"
                                    ></nz-option>
                                </nz-select>
                            </ng-container>
                            <ng-template #picLoad>
                                <nz-select nzShowSearch nzMode="tags" nzPlaceHolder="Select PIC" nzDisabled>
                                    <nz-option></nz-option>
                                </nz-select>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div class="col-md-4">
                    <nz-form-item>
                        <nz-form-label nzRequired class="fw-semibold" nzFor="engineer_pic_internal" nzRequired>Head of Engineer PIC</nz-form-label>
                        <nz-form-control>
                            <nz-select nzShowSearch nzPlaceHolder="Select Head" formControlName="engineer_pic_internal">
                            <ng-container *ngFor="let pic of filteredListOfPic">
                            <nz-option [nzLabel]="pic.name" [nzValue]="pic.pic_id"></nz-option>
                            </ng-container>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div class="col-md-4">
                    <nz-form-item>
                        <nz-form-label nzRequired nzFor="engineer_phone_number" class="fw-semibold">Engineer Phone Number</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="engineer_phone_number" id="engineer_phone_number" />
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <nz-tabset [nzAnimated]="false">
                    <nz-tab nzTitle="Project Item">
                        <div class="table-responsive">
                            <table class="table table-striped table-order table-purchase">
                                <thead style="position: unset;">
                                    <tr>
                                        <th scope="col">Product Description</th>
                                        <th scope="col">Part Number</th>
                                        <th scope="col">Alias</th>
                                        <th scope="col">DN</th>
                                        <th scope="col">DN</th>
                                        <th scope="col">Qty</th>
                                        <th scope="col">Unit</th>
                                        <th scope="col">#</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <ng-container formArrayName="items">
                                        <tr *ngFor="let item of items.controls; let i = index" [formGroupName]="i">
                                            <td>
                                                <nz-form-control>
                                                    <!-- <nz-select nzShowSearch  nzPlaceHolder="Description" formControlName="description">
                                                    </nz-select> -->
                                                    <input nz-input formControlName="description" id="description" />
                                                </nz-form-control>
                                            </td>
                                            <td>
                                                <nz-form-control>
                                                    <!-- <nz-select nzShowSearch  nzPlaceHolder="Part Number" formControlName="part_number">
                                                    </nz-select> -->
                                                    <input nz-input formControlName="part_number" id="part_number" />
                                                </nz-form-control>
                                            </td>
                                            <td>
                                                <nz-form-control>
                                                    <!-- <nz-select nzShowSearch  nzPlaceHolder="Alias" formControlName="alias">
                                                    </nz-select> -->
                                                    <input nz-input formControlName="alias" id="alias" />
                                                </nz-form-control>
                                            </td>
                                            <td>
                                                <nz-form-control>
                                                    <input nz-input formControlName="dn1" id="dn1" />
                                                </nz-form-control>
                                            </td>
                                            <td>
                                                <nz-form-control>
                                                    <input nz-input formControlName="dn2" id="dn2" />
                                                </nz-form-control>
                                            </td>
                                            <td>
                                                <nz-form-control>
                                                    <input nz-input formControlName="qty" id="qty" />
                                                </nz-form-control>
                                            </td>
                                            <td>
                                                <nz-form-control>
                                                    <!-- <nz-select nzShowSearch  nzPlaceHolder="Select Unit" formControlName="unit">
                                                    </nz-select> -->
                                                    <input nz-input formControlName="unit" id="unit" />
                                                </nz-form-control>
                                            </td>
                                            <td>
                                                <span (click)="removeItem(i)" nz-icon nzType="delete" nzTheme="twotone" [nzTwotoneColor]="'#ED0000'"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="10" class="text-center">
                                                <button (click)="addItems()" nz-button nzType="primary" class="w-75">Add Item</button>
                                            </td>
                                        </tr>
                                    </ng-container>
                                </tbody>
                            </table>
                        </div>
                    </nz-tab>
                </nz-tabset>
            </div>
        </form>
    </div>
    <div class="footer">
        <div class="d-flex gap-2 justify-content-end">
            <button nz-button nzType="default" (click)="closeDrawer()">Cancel</button>
            <button nz-button nzType="primary" (click)="submit()" [disabled]="!quotationForm.valid">{{ modal_type === 'add' || modal_type === 'duplicate' ? 'Add Quotation' : 'Edit Quotation' }}</button>
        </div>
    </div>
</div>